<!DOCTYPE html>
<!--{% block import %}-->
<html>
<head>
  <title>Page TEST</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script type="text/javascript" src="https://www.google.com/jsapi"></script>
  <script type="text/javascript" src="js/addons/jquery.knob.min.js"></script>
  <link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="css/custom.css">
  <link rel="stylesheet" type="text/css" href="css/testResultsPage.css">



</head>
<body id="mainBackground">
  <div class="container">
    <div class="row">
      <nav id="topNavBar" class="navbar navbar-inverse navbar-collapse collapse"> <!--NAVBAR-->
        <div class="container-fluid">
          <div class="navbar-header">
            <img class="logo" src="images/Glogo.png" style="width:110px;" alt="Gradient One logo">
          </div>
          <div id="navbar">
            <ul class="topmenu nav navbar-nav">
              <li><a class="currentPage" href="index.html" style="color: rgb(124,175,46);">CANVAS</a></li>
              <li class="dots glyphicon glyphicon-option-vertical"></li>
              <li><a href="instruments.html">INSTRUMENTS</a></li>
              <li class="dots glyphicon glyphicon-option-vertical"></li>
              <li><a href="community.html">COMMUNITY</a></li>          
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a class="glyphicon glyphicon-envelope" href="../navbar-static-top/"></a></li>
              <li><a class="glyphicon glyphicon-bell" href="../navbar-static-top/"></a></li>
              <li><a class="glyphicon glyphicon-user" href="../navbar-fixed-top/">Profile</a></li>
            </ul>
          </div>
        </div>
      </nav>
    </div>
    <div> <!--HEADER-->
        <div class="" style="min-width: 100px;" id="compHeader">
         <span id="backButton" class="glyphicon glyphicon-chevron-left"></span>
         <h1 class="compName" id="testPlanCompany">Test Results</h1> 
        </div>
      </div>
    <div class="container">
      <div class="row testResultsBox"><!--TEST RESULTS BOX -->
          <div class="col-md-4" id="testPlanInfoBox">
            <h1 class="testPlanInfo" id="testPlanName"></h1>  
              <h3 class="testPlanInfo" id="testPlanAuthor"></h3>
              <p class="testPlanInfo" id="testPlanDate"></p>
              <div id="measurementsBox">
                <h3><u>Test Measurements</u></h3>
                <p>-horizontal-</p>
                <div class="knobs">
                        <section>
                          <div id="knob1">
                            <p id="knob1Label">Position</p>
                            <input 
                            type="text" 
                            value="0"
                            data-step="1"
                            data-min="-10"
                            data-max="10" 
                            class="hPosition"
                            data-cursor= "10"
                            data-width="50"
                            data-fgColor="black"
                            data-thickness=".5"
                            data-bgColor="white"
                            data-angleOffset="-125"
                            data-angleArc="250">

                          </div>
                        </section>
                        <section id="horiz">
                          <div id="knob2">
                            <p id="knob2Label">Zoom</p>
                            <input 
                            type="text" 
                            value="0"
                            data-min="0"
                            data-max="10" 
                            class="hZoom"
                            data-cursor= "10"
                            data-width="50"
                            data-fgColor="black"
                            data-thickness=".5"
                            data-angleOffset="-125"
                            data-angleArc="250"
                            data-bgColor="white">
                          </div>
                        </section>
                      </div>
                <div  id="testMeasRes"></div>
              </div>
          </div>
          <div class="row-md-7" id="dataDisplayBox">
            <div class="row-md-6;" id="resultsChartCSS">
              <div id="resultsChart" style="height: 385px; width: 575px;"></div>
            </div>
            <div class="row-md-3" style="" id="resultsTableCSS">
              <div id="resultsTable"></div>
            </div>
          </div>
          
      </div>
    </div>
 


 <script type="text/javascript">



       $(".hPosition").knob({
        'release' : function (v) { 
          //console.log('knob V value:',v);  
          hPosition = v;
          doPoll(hPosition);
      },
    }); 



      $(".hZoom").knob({
        'release' : function (h) { 
          //console.log('knob H value:',h);
          hZoom = h;
          doPoll(hZoom);
      },
    }); 

 // load chart lib
       google.load('visualization', '1', {
          packages: ['corechart','table']
       });

       var hZoom = 0;
       var hPosition = 0;
       var fetchDataCalls = 0;
       var dataArray;
       var getLast;
       var getFirst;    
       var dataArray = [];
       var getFirsts = [];

       function doPoll(v, h){
          //var urlPath = window.location.pathname;
          //var urlPath = window.location.pathname.split( '/' );
          //var newPathname = urlPath[urlPath.length - 1];
          //console.log(urlPath);
          //console.log(newPathname);
          //^THIS READS THE CURRENT URL THAT IS OPEN ->file:///Users/william/Desktop/GradientOne/UI/testResultsPage.html

          
          
          var data = new google.visualization.DataTable();
          data.addColumn('number', 'Time');
          data.addColumn('number', 'Ch1');
          //data.addColumn('number', 'Ch2');

          function fetchData(){
            fetchDataCalls++;
            //console.log(json_url);
            var jsonData = $.ajax({
               url: json_url,            
               dataType: 'json',
            }).done(function (results) {   
                 //GETING DATA
               $.each(results['data'], function (i, row) {
                 data.addRow([
                   parseFloat(row.TIME),
                   parseFloat(row.CH1),
                   //parseFloat(row.CH2), 
                 ]);
          });

            //var testArray = dataArray[(dataArray.length-1)];
            //console.log('data array:',dataArray);
            //console.log('test:',testArray[0].TIME);
            //console.log(results.data.sort());
            //console.log('fetchData counter:',fetchDataCalls);
            //if (dataArray.indexOf(dataArray) === -1) {
             // dataArray.push(results.data);
            //};
            //$(arr1).not(arr2).length === 0 && $(arr2).not(arr1).length === 0
        

            if (getFirsts.indexOf(results.data[0].TIME) === -1) {
              getFirsts.push(results.data[0].TIME);
            };
            
          
            console.log('First TIMEs:',getFirsts);


             //getLast = dataArray[dataArray.length-1].TIME;
             //var timeSlice = getLast - getFirst;
             //console.log('Time Slice:',timeSlice);
             //console.log('Last TIME:',getLast);

             //DRAW CHART
             var chart = new google.visualization.LineChart($('#resultsChart').get(0));      
             chart.draw(data, chartOptions);
             //DRAW TABLE
             var table = new google.visualization.Table($('#resultsTable').get(0));
             table.draw(data, tableOptions);
            //setTimeout(doPoll,60000);

          });
          };
            
            //console.log('loaded data array:',dataArray);
            //console.log('choose array:',dataArray[1]);
            


          autoMaxPosition = (-498.80);
          autoMinPosition = (-499.80);
      //console.log('auto MAX position:',autoMaxPosition);
      //console.log('auto MIN position:',autoMinPosition);

            var hMax = (hZoom + hPosition + autoMaxPosition);
            var hMin = (-hZoom + hPosition + autoMinPosition);
            console.log('hMax:',hMax);
            console.log('hMin:',hMin);
            
         
          
          
          //var dateNow = new Date(parseInt(timeNow));
          //var dateNow = new Date(timeNow *1000);
        /*
        //GET TIME AND CONVERT TO DATE
          var timeNow = Date.now();
          date = new Date(timeNow * 1000);
          dateFormat = [
             date.getFullYear(),
             date.getMonth()+1,
             date.getDate(),
             date.getHours(),
             date.getMinutes(),
             date.getSeconds(),
          ];
          console.log('time now:', dateFormat)
          */


 //BUILDING SLICE NAMES
          //var slices = [];
            //for(i=0;i<=();i+=100) {
            //slices.push('/' + (i) + '-' + (i+99));
            //};
        
          //console.log('Slices',slices);


          var sliceNames = ['2015-06-17-14-09-28-200-299', '2015-06-17-14-09-28-300-399', '2015-06-17-14-09-28-400-499', '2015-06-17-14-09-28-500-599']
          //var sliceNames = ['/2015-06-16-22-43-29-400-499','/2015-06-16-22-43-29-500-599','/2015-06-16-22-43-29-600-699'];

          var first_url = 'http://gradientone-test.appspot.com/oscopedata/amplifier/2015-06-17-14-09-28-100-199';  
          json_url = first_url; 
          fetchData(json_url);

          var base_url = 'http://gradientone-test.appspot.com/oscopedata/amplifier/';
          for(i=0; i <= sliceNames.length; i++) {
            var pageTrig = (parseFloat(getFirsts[i]))+0.99;
            console.log('> test:', hMax > pageTrig);
            
            if(hMax > pageTrig) { 
              json_url = base_url + sliceNames[i];
              fetchData(json_url);
            };   
          };


            //var hZoom =;
            //var hPosition =;

            //console.log('horizontal Zoom dial:',hZoom);
            //console.log('horizontal position dial:',hPosition);
            
          

        var chartOptions = {
            title: 'Oscope Data',
            titleTextStyle: {color:'lightgray', fontSize: 18, fontName: 'NexaLight'},
            legend: {alignment:'center', textStyle:{color:'lightgray'}},
            hAxis: {title: 'Time({units})',titleTextStyle:{color:'lightgray', fontName: 'NexaLight'}, textStyle:{color:'lightgray'}, baselineColor:'white', gridlines:{color: 'gray', count: 6}, minorGridlines:{color: 'gray', count: 1}, viewWindowMode:'explicit', viewWindow:{max: hMax, min:hMin}},
            vAxis: {title: '', titleTextStyle:{color:'lightgray'}, textStyle:{color:'lightgray'}, baselineColor:'white', gridlines:{color: 'gray', count: 6}, minorGridlines:{color: 'gray', count: 1}, format: '##.###', viewWindowMode:'explicit', viewWindow:{max:2.5, min:-2.5} },
            backgroundColor: {fill:'rgb(40,45,45)', stroke: 'black', strokeWidth: 5,},                 
            colors: ['rgb(2,255,253)','rgb(239,253,146)'],
            chartArea:{backgroundColor:'', height:300, width:445},
            lineWidth: 1.25,
            curveType: 'function',
            crosshair: {trigger: 'both', selected:{opacity: 0.8}, focused:{opacity:0.8}},
          };
          var tableOptions = {
            showRowNumber: true,
            oddTableRow:{color:'green'},
          }
        };
       google.setOnLoadCallback(doPoll);



</script>

</body>
</html>
<!--{% endblock %}-->